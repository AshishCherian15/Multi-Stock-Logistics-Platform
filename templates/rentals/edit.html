{% extends 'base.html' %}
{% block title %}Edit Rental Item{% endblock %}
{% block content %}
<style>
:root{--zaffre:#0014A8;--zaffre-dark:#000E75}
.btn-primary{background:linear-gradient(135deg,var(--zaffre),var(--zaffre-dark))!important;border:none!important}
</style>
<div class="container p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-edit me-2"></i>Edit Rental Item</h2>
        <a href="/rentals/" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i>Back to List</a>
    </div>
    <div class="card shadow-sm">
        <div class="card-header" style="background:linear-gradient(135deg,#0014A8,#000E75);color:#fff">
            <h5 class="mb-0"><i class="fas fa-tools me-2"></i>Rental Item Details</h5>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="editForm">
                {% csrf_token %}
                <ul class="nav nav-tabs mb-3" role="tablist">
                    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#basic"><i class="fas fa-info-circle me-1"></i>Basic Info</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#pricing"><i class="fas fa-dollar-sign me-1"></i>Pricing</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#media"><i class="fas fa-image me-1"></i>Media</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#specs"><i class="fas fa-cogs me-1"></i>Specifications</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#booking"><i class="fas fa-calendar me-1"></i>Booking Info</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="basic">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Rental Item ID</label>
                                <input type="text" class="form-control" value="RNT-{{ item.id }}" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Item Name *</label>
                                <input type="text" class="form-control" name="name" value="{{ item.name }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Category / Type</label>
                                <input type="text" class="form-control" name="category" value="{{ item.category|default:'' }}" placeholder="e.g., Equipment, Vehicle, Tool">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Status *</label>
                                <select class="form-select" name="status" required>
                                    <option value="available" {% if item.status == 'available' %}selected{% endif %}>Available</option>
                                    <option value="booked" {% if item.status == 'booked' %}selected{% endif %}>Booked</option>
                                    <option value="maintenance" {% if item.status == 'maintenance' %}selected{% endif %}>Maintenance</option>
                                </select>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Description</label>
                                <textarea class="form-control" name="description" rows="4" placeholder="Detailed description of the rental item...">{{ item.description }}</textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Location</label>
                                <input type="text" class="form-control" name="location" value="{{ item.location|default:'' }}" placeholder="Warehouse, section, shelf">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Condition</label>
                                <select class="form-select" name="condition">
                                    <option value="new">New</option>
                                    <option value="good" selected>Good</option>
                                    <option value="fair">Fair</option>
                                    <option value="repair">Needs Repair</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pricing">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Hourly Rate (₹)</label>
                                <input type="number" class="form-control" name="hourly_rate" value="{{ item.hourly_rate }}" step="0.01" min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Daily Rate (₹)</label>
                                <input type="number" class="form-control" name="daily_rate" value="{{ item.daily_rate }}" step="0.01" min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Weekly Rate (₹)</label>
                                <input type="number" class="form-control" name="weekly_rate" value="{{ item.weekly_rate }}" step="0.01" min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Monthly Rate (₹)</label>
                                <input type="number" class="form-control" name="monthly_rate" value="{{ item.monthly_rate }}" step="0.01" min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Security Deposit (₹)</label>
                                <input type="number" class="form-control" name="security_deposit" value="{{ item.security_deposit|default:'0' }}" step="0.01" min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Late Fee (₹/day)</label>
                                <input type="number" class="form-control" name="late_fee" value="{{ item.late_fee|default:'0' }}" step="0.01" min="0">
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Pricing Notes</label>
                                <textarea class="form-control" name="pricing_notes" rows="3" placeholder="Special pricing, discounts, bulk rates...">{{ item.pricing_notes|default:'' }}</textarea>
                            </div>
                            <div class="col-md-12">
                                <div class="alert alert-info"><i class="fas fa-info-circle me-2"></i>Pricing will be calculated based on duration selected during booking</div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="media">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Image Upload</label>
                                <input type="file" class="form-control" name="image" id="imageUpload" accept="image/*" onchange="previewImage(this)">
                                <small class="text-muted">Supported: JPG, PNG, GIF (Max 5MB)</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Image URL</label>
                                <input type="text" class="form-control" id="imageUrl" placeholder="Or paste image URL" onchange="previewImageUrl(this)">
                                <small class="text-muted">Alternative to file upload</small>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Current Image Preview</label>
                                <div class="border rounded p-3 bg-light text-center">
                                    {% if item.image %}
                                    <img id="imagePreview" src="{{ item.image.url }}" style="max-height:250px;max-width:100%;object-fit:contain;border-radius:8px" class="img-thumbnail">
                                    {% else %}
                                    <img id="imagePreview" src="/static/images/rental_equipment.png" style="max-height:250px;max-width:100%;object-fit:contain;border-radius:8px" class="img-thumbnail">
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Additional Images</label>
                                <input type="file" class="form-control" name="additional_images" multiple accept="image/*">
                                <small class="text-muted">Upload multiple images (gallery view)</small>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="specs">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Brand / Manufacturer</label>
                                <input type="text" class="form-control" name="brand" value="{{ item.brand|default:'' }}" placeholder="e.g., Caterpillar, Bosch">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Model Number</label>
                                <input type="text" class="form-control" name="model" value="{{ item.model|default:'' }}" placeholder="Model/SKU">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Serial Number</label>
                                <input type="text" class="form-control" name="serial_number" value="{{ item.serial_number|default:'' }}" placeholder="Unique identifier">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Year / Age</label>
                                <input type="text" class="form-control" name="year" value="{{ item.year|default:'' }}" placeholder="Manufacturing year">
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Dimensions / Weight</label>
                                <input type="text" class="form-control" name="dimensions" value="{{ item.dimensions|default:'' }}" placeholder="e.g., 10x5x3 ft, 500 kg">
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Features & Specifications</label>
                                <textarea class="form-control" name="features" rows="4" placeholder="Key features, technical specs, capabilities...">{{ item.features|default:'' }}</textarea>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Maintenance History</label>
                                <textarea class="form-control" name="maintenance_history" rows="3" placeholder="Last service, repairs, inspections...">{{ item.maintenance_history|default:'' }}</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="booking">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Minimum Rental Period</label>
                                <select class="form-select" name="min_rental_period">
                                    <option value="hourly">Hourly</option>
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Maximum Rental Period</label>
                                <select class="form-select" name="max_rental_period">
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="yearly" selected>Yearly</option>
                                    <option value="unlimited">Unlimited</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Advance Booking Days</label>
                                <input type="number" class="form-control" name="advance_booking_days" value="{{ item.advance_booking_days|default:'7' }}" min="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Cancellation Policy</label>
                                <select class="form-select" name="cancellation_policy">
                                    <option value="flexible">Flexible (24h notice)</option>
                                    <option value="moderate" selected>Moderate (48h notice)</option>
                                    <option value="strict">Strict (7 days notice)</option>
                                    <option value="non-refundable">Non-refundable</option>
                                </select>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Terms & Conditions</label>
                                <textarea class="form-control" name="terms" rows="4" placeholder="Rental terms, usage restrictions, liability clauses...">{{ item.terms|default:'' }}</textarea>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold">Damage Policy</label>
                                <textarea class="form-control" name="damage_policy" rows="3" placeholder="Return conditions, damage charges, inspection process...">{{ item.damage_policy|default:'' }}</textarea>
                            </div>
                            <div class="col-md-12">
                                <div class="alert alert-secondary"><small><i class="fas fa-user me-1"></i>Last modified by: <strong>Admin</strong> • <i class="fas fa-clock me-1"></i>{{ item.updated_at|default:'Today' }}</small></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save me-1"></i>Save Changes</button>
                    <a href="/rentals/" class="btn btn-secondary"><i class="fas fa-times me-1"></i>Cancel</a>
                    <button type="button" class="btn btn-outline-danger ms-auto" onclick="confirmDelete()"><i class="fas fa-trash me-1"></i>Delete Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('imagePreview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function previewImageUrl(input) {
    const url = input.value.trim();
    if (url) {
        document.getElementById('imagePreview').src = url;
    }
}

function confirmDelete() {
    if (confirm('Are you sure you want to delete this rental item? This action cannot be undone.')) {
        window.location.href = '/rentals/{{ item.id }}/delete/';
    }
}
</script>
{% endblock %}
