{% extends 'base.html' %}
{% block title %}Coupons Analytics - MultiStock{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-chart-line me-2"></i>Coupons Analytics</h2>
        <div class="btn-group">
            <button class="btn btn-outline-primary" onclick="filterData('week')">Week</button>
            <button class="btn btn-outline-primary active" onclick="filterData('month')">Month</button>
            <button class="btn btn-outline-primary" onclick="filterData('year')">Year</button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-ticket-alt fa-2x mb-2" style="color:#0014A8"></i>
                    <h6 class="text-muted">Total Coupons</h6>
                    <h3 class="mb-0" id="totalCoupons">{{ total_coupons|default:0 }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-check-circle fa-2x mb-2" style="color:#28a745"></i>
                    <h6 class="text-muted">Active Coupons</h6>
                    <h3 class="mb-0" id="activeCoupons">{{ active_coupons|default:0 }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-2x mb-2" style="color:#ffc107"></i>
                    <h6 class="text-muted">Total Redemptions</h6>
                    <h3 class="mb-0" id="totalRedemptions">{{ total_redemptions|default:0 }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-rupee-sign fa-2x mb-2" style="color:#17a2b8"></i>
                    <h6 class="text-muted">Total Savings</h6>
                    <h3 class="mb-0" id="totalSavings">₹{{ total_savings|default:0 }}</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Redemption Trends</h5>
                </div>
                <div class="card-body">
                    <canvas id="trendChart" style="max-height:300px"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Coupon Status</h5>
                </div>
                <div class="card-body">
                    <canvas id="statusChart" style="max-height:300px"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Top Performing Coupons</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Redemptions</th>
                                    <th>Savings</th>
                                </tr>
                            </thead>
                            <tbody id="topCoupons">
                                <tr><td>SAVE20</td><td>145</td><td>₹28,900</td></tr>
                                <tr><td>FIRST50</td><td>98</td><td>₹49,000</td></tr>
                                <tr><td>WELCOME10</td><td>76</td><td>₹7,600</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush" id="recentActivity">
                        <div class="list-group-item d-flex justify-content-between">
                            <div><strong>SAVE20</strong> used by Customer #1234</div>
                            <small class="text-muted">2m ago</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <div><strong>FIRST50</strong> used by Customer #5678</div>
                            <small class="text-muted">15m ago</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between">
                            <div><strong>WELCOME10</strong> used by Customer #9012</div>
                            <small class="text-muted">1h ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
const trendCtx=document.getElementById('trendChart');
new Chart(trendCtx,{
type:'line',
data:{
labels:['Week 1','Week 2','Week 3','Week 4'],
datasets:[{
label:'Redemptions',
data:[45,62,58,73],
borderColor:'#0014A8',
backgroundColor:'rgba(0,20,168,0.1)',
tension:0.4,
fill:true
}]
},
options:{
responsive:true,
maintainAspectRatio:true,
plugins:{legend:{display:true,position:'top'}},
scales:{y:{beginAtZero:true}}
}
});

const statusCtx=document.getElementById('statusChart');
new Chart(statusCtx,{
type:'doughnut',
data:{
labels:['Active','Expired','Exhausted'],
datasets:[{
data:[12,5,3],
backgroundColor:['#28a745','#dc3545','#ffc107']
}]
},
options:{
responsive:true,
maintainAspectRatio:true,
plugins:{legend:{display:true,position:'bottom'}}
}
});

function filterData(period){
document.querySelectorAll('.btn-group .btn').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
console.log('Filter by:',period);
}
</script>
{% endblock %}
