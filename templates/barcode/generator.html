{% extends 'base.html' %}

{% block title %}Barcode Generator - MultiStock{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1><i class="fas fa-barcode me-2"></i>Barcode Generator</h1>
        <p class="lead">Generate and print product barcodes</p>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-cogs me-2"></i>Barcode Settings</h5>
            </div>
            <div class="card-body">
                <form id="barcodeForm">
                    <div class="mb-3">
                        <label class="form-label">1. Select Warehouse</label>
                        <select class="form-select" name="warehouse" required>
                            <option value="">Choose Warehouse</option>
                            <option value="wh1">Warehouse A</option>
                            <option value="wh2">Warehouse B</option>
                            <option value="wh3">Warehouse C</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">2. Select Product</label>
                        <select class="form-select" name="product" required>
                            <option value="">Choose Product</option>
                            <option value="prod1">iPhone 13 Pro - IPHONE13PRO</option>
                            <option value="prod2">MacBook Air M2 - MACBOOKAIR</option>
                            <option value="prod3">Samsung Galaxy S23 - GALAXYS23</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">3. Set Quantity</label>
                        <input type="number" class="form-control" name="quantity" value="1" min="1" max="100" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">4. Choose Paper Size</label>
                        <select class="form-select" name="paper_size" required>
                            <option value="a4">A4 (210 x 297 mm)</option>
                            <option value="letter">Letter (8.5 x 11 in)</option>
                            <option value="label">Label Sheet (Avery 5160)</option>
                        </select>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary" onclick="updatePreview()">
                            <i class="fas fa-sync me-2"></i>5. Update Preview
                        </button>
                        <button type="button" class="btn btn-success" onclick="printBarcodes()">
                            <i class="fas fa-print me-2"></i>6. Print Barcodes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-eye me-2"></i>Preview</h5>
            </div>
            <div class="card-body">
                <div id="barcodePreview" class="text-center">
                    <p class="text-muted">Select product and settings to see preview</p>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>Instructions</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Select the warehouse where products are stored</li>
                    <li>Choose the product you want to generate barcodes for</li>
                    <li>Set the number of barcode labels needed</li>
                    <li>Choose appropriate paper size for your printer</li>
                    <li>Click "Update Preview" to see how labels will look</li>
                    <li>Click "Print" to generate and print the barcodes</li>
                </ol>
                
                <div class="alert alert-info mt-3">
                    <strong>Tip:</strong> Use Label Sheet format for adhesive labels, A4/Letter for regular paper cutting.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updatePreview() {
    const form = document.getElementById('barcodeForm');
    const formData = new FormData(form);
    
    const product = form.product.options[form.product.selectedIndex].text;
    const quantity = formData.get('quantity');
    const paperSize = form.paper_size.options[form.paper_size.selectedIndex].text;
    
    if (!formData.get('product')) {
        alert('Please select a product first');
        return;
    }
    
    const preview = document.getElementById('barcodePreview');
    preview.innerHTML = `
        <div class="border p-3 mb-3">
            <h6>${product}</h6>
            <div style="font-family: 'Courier New', monospace; font-size: 24px; letter-spacing: 2px; border: 1px solid #000; padding: 10px; margin: 10px 0;">
                ||||| |||| | |||| |||||
            </div>
            <small>Sample Barcode</small>
        </div>
        <p><strong>Quantity:</strong> ${quantity} labels</p>
        <p><strong>Paper Size:</strong> ${paperSize}</p>
        <div class="alert alert-success">
            Preview updated! Ready to print.
        </div>
    `;
}

function printBarcodes() {
    const form = document.getElementById('barcodeForm');
    const formData = new FormData(form);
    
    if (!formData.get('product') || !formData.get('warehouse')) {
        alert('Please fill in all required fields');
        return;
    }
    
    // Simulate barcode generation and printing
    const quantity = formData.get('quantity');
    const product = form.product.options[form.product.selectedIndex].text;
    
    // Create print window
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Barcode Labels</title>
            <style>
                body { font-family: Arial, sans-serif; }
                .barcode-label { 
                    display: inline-block; 
                    margin: 10px; 
                    padding: 15px; 
                    border: 1px solid #000; 
                    text-align: center;
                    width: 200px;
                }
                .barcode { 
                    font-family: 'Courier New', monospace; 
                    font-size: 20px; 
                    letter-spacing: 1px; 
                    margin: 10px 0;
                }
                @media print {
                    .no-print { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="no-print">
                <button onclick="window.print()">Print Labels</button>
                <button onclick="window.close()">Close</button>
            </div>
            ${Array.from({length: quantity}, (_, i) => `
                <div class="barcode-label">
                    <div><strong>${product.split(' - ')[0]}</strong></div>
                    <div class="barcode">||||| |||| | |||| |||||</div>
                    <div><small>${product.split(' - ')[1] || 'BARCODE'}</small></div>
                </div>
            `).join('')}
        </body>
        </html>
    `);
    
    printWindow.document.close();
    
    alert(`${quantity} barcode labels generated successfully!`);
}
</script>
{% endblock %}
